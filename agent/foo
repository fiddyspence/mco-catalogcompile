       Puppet.settings.preferred_run_mode = :apply
        unless Puppet.settings.app_defaults_initialized?
          Puppet.settings.initialize_app_defaults(Puppet::Settings.app_defaults_for_run_mode(Puppet.run_mode))
        end


request = { :catalog => File.read('/tmp/catalog') }
       require 'puppet'
require 'puppet/application'
require 'puppet/configurer'
       Puppet.settings.preferred_run_mode = :apply
        unless Puppet.settings.app_defaults_initialized?
          Puppet.settings.initialize_app_defaults(Puppet::Settings.app_defaults_for_run_mode(Puppet.run_mode))
        end
      Puppet::Util::Log.level = :info


    begin
      catalog = Puppet::Resource::Catalog.convert_from(Puppet::Resource::Catalog.default_format,request[:catalog])
      catalog = Puppet::Resource::Catalog.pson_create(catalog) unless catalog.is_a?(Puppet::Resource::Catalog)
    rescue => detail
      raise Puppet::Error, "Could not deserialize catalog from pson: #{detail}"
    end

    configurer = Puppet::Configurer.new
    configurer.run(:catalog => catalog.to_ral, :pluginsync => false)
